<!-- Modal Novo Exercício -->
<div class="modal fade" id="modalNovoExercicio" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header" style="background: #2D2D2D; color: white;">
                <h5 class="modal-title">
                    <i class="bi bi-database-add"></i> Novo Exercício
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <form action="{{ url_for('admin.salvar_exercicio') }}" method="post" id="formNovoExercicio">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                <div class="modal-body">
                    <ul class="nav nav-tabs mb-3" id="novoExercicioTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="selecionar-tab" data-bs-toggle="tab" 
                                    data-bs-target="#selecionar" type="button" role="tab"
                                    style="color: #F28C33 !important;">
                                <i class="bi bi-search"></i> Selecionar do Catálogo
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="criar-tab" data-bs-toggle="tab" 
                                    data-bs-target="#criar" type="button" role="tab"
                                    style="color: #F28C33 !important;">
                                <i class="bi bi-pencil"></i> Criar Manualmente
                            </button>
                        </li>
                    </ul>
                    
                    <div class="tab-content">
                        <!-- Aba de Seleção do Catálogo -->
                        <div class="tab-pane fade show active" id="selecionar" role="tabpanel">
                            <div class="mb-3">
                                <label class="form-label fw-bold">Buscar Exercício</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="bi bi-search"></i></span>
                                    <input type="text" id="buscaExercicio" class="form-control" 
                                           placeholder="Digite para buscar exercícios..." autocomplete="off">
                                </div>
                                <small class="text-muted">Digite pelo menos 2 caracteres para buscar</small>
                            </div>
                            
                            <div id="resultadosBusca" style="max-height: 300px; overflow-y: auto; border: 1px solid #dee2e6; border-radius: 5px; padding: 10px; display: none;">
                                <div class="list-group" id="listaResultados"></div>
                            </div>
                            
                            <div class="mt-3" id="exercicioSelecionadoInfo" style="display: none;">
                                <div class="alert alert-success">
                                    <h6 class="alert-heading">Exercício Selecionado:</h6>
                                    <p class="mb-1"><strong>Nome:</strong> <span id="selectedNome"></span></p>
                                    <p class="mb-0"><strong>Músculo:</strong> <span id="selectedMusculo"></span></p>
                                </div>
                                <input type="hidden" id="selectedNomeInput" name="nome_catalogo">
                                <input type="hidden" id="selectedMusculoInput" name="musculo_catalogo">
                            </div>
                        </div>
                        
                        <!-- Aba de Criação Manual -->
                        <div class="tab-pane fade" id="criar" role="tabpanel">
                            <div class="row">
                                <div class="col-md-8 mb-3">
                                    <label class="form-label fw-bold">Nome do Exercício</label>
                                    <div class="input-group">
                                        <input type="text" name="nome_manual" id="manual_nome" class="form-control" 
                                               placeholder="Ex: Rosca direta">
                                        <button type="button" class="btn btn-outline-primary" onclick="BuscaExerciciosManual.buscarMusculo()">
                                            <i class="bi bi-search"></i> Buscar Músculo
                                        </button>
                                    </div>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label class="form-label fw-bold">Músculo</label>
                                    <select name="musculo_manual" id="manual_musculo" class="form-select">
                                        <option value="">Selecione ou busque...</option>
                                        {% for m in musculos %}
                                        <option value="{{ m }}">{{ m }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label fw-bold">Descrição (opcional)</label>
                                <textarea name="descricao_manual" id="manual_descricao" class="form-control" 
                                          rows="2" placeholder="Ex: Foco na parte inferior"></textarea>
                            </div>
                            <div id="resultadoBuscaManual" class="mt-2" style="display: none;">
                                <div class="alert alert-info">
                                    <i class="bi bi-info-circle"></i> <span id="mensagemBuscaManual"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <input type="hidden" name="nome" id="final_nome">
                    <input type="hidden" name="musculo" id="final_musculo">
                    
                    <div class="mb-3 mt-3">
                        <label class="form-label fw-bold">Treino (opcional)</label>
                        <select name="treino" id="novo_treino" class="form-select">
                            <option value="">Não associar a nenhum treino</option>
                            {% for t in treinos %}
                            <option value="{{ t.id }}">{{ t.codigo }} - {{ t.nome }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn" style="background: #2D2D2D; color: white; border: none;" onclick="return prepararEnvioNovoExercicio()">
                        <i class="bi bi-save"></i> Salvar Exercício
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    function prepararEnvioNovoExercicio() {
        const activeTab = document.querySelector('#novoExercicioTabs .nav-link.active');
        
        if (activeTab && activeTab.id === 'selecionar-tab') {
            const nome = document.getElementById('selectedNomeInput').value;
            if (!nome) {
                alert('Selecione um exercício do catálogo!');
                return false;
            }
            document.getElementById('final_nome').value = nome;
            document.getElementById('final_musculo').value = document.getElementById('selectedMusculoInput').value;
        } else {
            const nome = document.getElementById('manual_nome').value.trim();
            if (!nome) {
                alert('Digite o nome do exercício!');
                return false;
            }
            document.getElementById('final_nome').value = nome;
            document.getElementById('final_musculo').value = document.getElementById('manual_musculo').value || 'Outros';
        }
        return true;
    }
</script>